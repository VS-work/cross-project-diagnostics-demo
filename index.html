<html>

<head>
  <script src="./dist/frontend.js"></script>
</head>

<body>
  <script>
    const vizabi = new frontend.Vizabi();

    function showHide(id) {
      const elContent = document.getElementById(`a${id}`);
      const elLink = document.getElementById(`aa${id}`);
      elContent.style.display = elContent.style.display === 'none' ? 'inline' : 'none';
      elLink.innerText = elLink.innerText === 'show' ? 'hide' : 'show';
    }

    function getDiagTable(diagContent) {
      let result = `<table border="1"><tr><td>Module</td><td>Query</td><td>Message</td><td>Version</td><td>Severity</td><td>Function</td><td>Attachment</td></tr>`;
      let i = 0;

      for (const r of diagContent) {
        result += `<tr><td>${r.module}</td><td>${r.instance}</td><td>${r.message}</td><td>${r.version}</td><td>?</td><td>${r.function}</td>`;

        if (r.attachment) {
          result += `<td><a id="aa${i}" href="#" onclick="showHide(${i})">show</a><span id="a${i}" style="display: none;">${JSON.stringify(r.attachment, null, 2)}</span></td></tr>`;
        } else {
          result += `<td>&nbsp;</td></tr>`;
        }

        ++i;
      }

      result += '</table>';

      return result;
    }

    function newChart() {
      const isDiagnostics = document.getElementById('chkDiag').checked;
      const hasError = document.getElementById('chkError').checked;
      const hasWarning = document.getElementById('chkWarning').checked;
      const delay = Number(document.getElementById('delay').value || 0) * 1000;
      const elProgress = document.getElementById('progress');
      const elResult = document.getElementById('result');

      elProgress.innerHTML = 'in progress...';
      vizabi.chart(isDiagnostics, hasError, hasWarning, delay, (diagContent) => {
        elProgress.innerHTML = '';
        // elResult.innerHTML = JSON.stringify(diagContent, null, 2);
        elResult.innerHTML = getDiagTable(diagContent);
      });
    }
  </script>

  <div>
    Delay, sec <input type="text" id="delay" value="5" size="4" maxlength="4">&nbsp;
    <input type="checkbox" id="chkError" /><label for="chkError">Error</label>&nbsp;
    <input type="checkbox" id="chkWarning" /><label for="chkWarning">Warning</label>&nbsp;
    <input type="button" value="new chart" onclick="newChart()" />
    <input type="checkbox" id="chkDiag" checked /><label for="chkDiag">Diagnostics</label>&nbsp;
    <span id="progress" style="color: red;"></span>
  </div>

  <div id="result"></div>
</body>

</html>
