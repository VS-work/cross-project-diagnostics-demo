<html>

<head>
  <script src="./dist/frontend.js"></script>
</head>

<body>
  <script>
    const vizabi = new frontend.Vizabi();

    function showHide(id) {
      const elContent = document.getElementById(`a${id}`);
      const elLink = document.getElementById(`aa${id}`);
      elContent.style.display = elContent.style.display === 'none' ? 'inline' : 'none';
      elLink.innerText = elLink.innerText === 'show' ? 'hide' : 'show';
    }

    function setDiagTable(diagContent) {
      const resultTable = document.getElementById('result');

      let i = 0;

      for (const r of diagContent) {
        const row = resultTable.insertRow();

        let cell = row.insertCell();
        cell.innerHTML = r.module;

        cell = row.insertCell();
        cell.innerHTML = r.requestId;

        cell = row.insertCell();
        cell.innerHTML = r.message;

        cell = row.insertCell();
        cell.innerHTML = r.version;

        cell = row.insertCell();
        cell.innerHTML = frontend.getLabelByLevel(r.level);

        cell = row.insertCell();
        cell.innerHTML = r.funName;

        cell = row.insertCell();

        if (r.attachment) {
          cell.innerHTML = `<a id="aa${i}" href="#" onclick="showHide(${i})">show</a><span id="a${i}" style="display: none;">${JSON.stringify(r.attachment, null, 2)}</span>`;
        } else {
          cell.innerHTML = '&nbsp;';
        }
        i++;
      }
    }

    function newChart() {
      const emulateFatal = document.getElementById('chkFatal').checked;
      const emulateError = document.getElementById('chkError').checked;
      const emulateWarning = document.getElementById('chkWarning').checked;
      const delay = Number(document.getElementById('delay').value || 0) * 1000;
      const level = document.getElementById('level').value;
      const elProgress = document.getElementById('progress');
      const elResult = document.getElementById('result');

      const requestId = vizabi.chart(delay, level, emulateFatal, emulateError, emulateWarning, (diagContent) => {
        elProgress.innerHTML += `${requestId} is done...<br>`;
        setDiagTable(diagContent);
      });
      elProgress.innerHTML += `${requestId} in progress...<br>`;
    }
  </script>

  <div>
    Delay, sec <input type="text" id="delay" value="5" size="4" maxlength="4">&nbsp;
    <select id="level">
      <option value="OFF">OFF</option>
      <option value="FATAL">FATAL</option>
      <option value="ERROR">ERROR</option>
      <option value="WARNING">WARNING</option>
      <option value="DEBUG">DEBUG</option>
      <option value="ALL" selected>ALL</option>
    </select>
    <input type="checkbox" id="chkFatal" /><label for="chkFatal">Emulate FATAL</label>&nbsp;
    <input type="checkbox" id="chkError" /><label for="chkError">Emulate ERROR</label>&nbsp;
    <input type="checkbox" id="chkWarning" /><label for="chkWarning">Emulate WARNING</label>&nbsp;
    <input type="button" value="new chart" onclick="newChart()" />
  </div>

  <hr>

  <table>
    <tr>
      <td valign="top">
        <div id="progress"></div>
      </td>
      <td valign="top">
        <table border="1" id="result">
          <thead>
            <th>Module</th>
            <th>Request ID</th>
            <th>Message</th>
            <th>Version</th>
            <th>Severity Level</th>
            <th>Function</th>
            <th>Attachment</th>
          </thead>
        </table>
      </td>
    </tr>
  </table>

</body>

</html>
